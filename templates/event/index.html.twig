{% extends 'base.html.twig' %}

{% block title %}Tous les événements{% endblock %}

{% block body %}
    <div class="page-header">
        <div class="container">
            <h1 class="page-title animate-fade-in">
                <i class="fas fa-calendar-alt"></i> Tous les Événements
            </h1>
            <p class="page-subtitle animate-fade-in">Découvrez et réservez les meilleurs événements</p>
        </div>
    </div>

    <section class="events-listing">
        <div class="container">
            <div class="events-layout">
                <!-- Sidebar Filters -->
                <aside class="filters-sidebar animate-slide-right">
                    <div class="filters-card">
                        <h3 class="filters-title">
                            <i class="fas fa-filter"></i> Filtres
                        </h3>

                        <!-- Search Filter -->
                        <div class="filter-group">
                            <label class="filter-label">
                                <i class="fas fa-search"></i> Recherche
                            </label>
                            <form action="{{ path('default_event_index') }}" method="get" class="search-form">
                                <input
                                    type="text"
                                    name="search"
                                    class="form-control"
                                    placeholder="Rechercher un événement..."
                                    value="{{ current_search ?? '' }}"
                                >
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-search"></i>
                                </button>
                            </form>
                        </div>

                        <!-- Category Filter -->
                        <div class="filter-group">
                            <label class="filter-label">
                                <i class="fas fa-tags"></i> Catégories
                            </label>
                            <div class="category-list">
                                <a href="{{ path('default_event_index') }}"
                                   class="category-item {{ current_category is null ? 'active' : '' }}">
                                    <i class="fas fa-globe"></i> Toutes les catégories
                                </a>
                                {% for category in categories %}
                                    <a href="{{ path('default_event_index', {category: category}) }}"
                                       class="category-item {{ current_category == category ? 'active' : '' }}">
                                        <i class="fas fa-tag"></i> {{ category }}
                                    </a>
                                {% endfor %}
                            </div>
                        </div>

                        <!-- Sort Filter -->
                        <div class="filter-group">
                            <label class="filter-label">
                                <i class="fas fa-sort"></i> Trier par
                            </label>
                            <select class="form-control" id="sortFilter" onchange="applySortFilter(this.value)">
                                <option value="date" {{ current_sort == 'date' ? 'selected' : '' }}>Date (proche)</option>
                                <option value="date_desc" {{ current_sort == 'date_desc' ? 'selected' : '' }}>Date (éloignée)</option>
                                <option value="price_asc" {{ current_sort == 'price_asc' ? 'selected' : '' }}>Prix (croissant)</option>
                                <option value="price_desc" {{ current_sort == 'price_desc' ? 'selected' : '' }}>Prix (décroissant)</option>
                                <option value="name" {{ current_sort == 'name' ? 'selected' : '' }}>Nom (A-Z)</option>
                            </select>
                        </div>

                        <!-- Reset Filters -->
                        {% if current_category or current_search or current_sort != 'date' %}
                            <div class="filter-actions">
                                <a href="{{ path('default_event_index') }}" class="btn btn-outline btn-block">
                                    <i class="fas fa-times"></i> Réinitialiser
                                </a>
                            </div>
                        {% endif %}
                    </div>
                </aside>

                <!-- Events Grid -->
                <div class="events-content">
                    <!-- Results Info -->
                    <div class="results-info animate-fade-in">
                        <div class="results-count">
                            <strong>{{ events|length }}</strong> événement(s) trouvé(s)
                            {% if current_category %}
                                dans <strong>{{ current_category }}</strong>
                            {% endif %}
                            {% if current_search %}
                                pour "<strong>{{ current_search }}</strong>"
                            {% endif %}
                        </div>
                        <button class="btn btn-sm btn-outline mobile-filter-toggle" onclick="toggleMobileFilters()">
                            <i class="fas fa-sliders-h"></i> Filtres
                        </button>
                    </div>

                    <!-- Events Grid -->
                    {% if events|length > 0 %}
                        <div class="events-grid">
                            {% for event in events %}
                                <div class="event-card animate-on-scroll" style="animation-delay: {{ loop.index * 0.05 }}s">
                                    {% if event.image %}
                                        <div class="event-image" style="background-image: url('{{ asset('uploads/events/' ~ event.image) }}')">
                                            {% if event.featured %}
                                                <div class="event-badge">À la une</div>
                                            {% endif %}
                                        </div>
                                    {% else %}
                                        <div class="event-image event-image-default">
                                            <i class="fas fa-calendar-alt"></i>
                                            {% if event.featured %}
                                                <div class="event-badge">À la une</div>
                                            {% endif %}
                                        </div>
                                    {% endif %}

                                    <div class="event-content">
                                        <div class="event-header">
                                            <span class="event-category">{{ event.category }}</span>
                                            {% if event.availableSeats < 10 and event.availableSeats > 0 %}
                                                <span class="event-status warning">Places limitées</span>
                                            {% elseif event.availableSeats == 0 %}
                                                <span class="event-status danger">Complet</span>
                                            {% endif %}
                                        </div>

                                        <h3 class="event-title">
                                            <a href="{{ path('default_event_show', {id: event.id}) }}">
                                                {{ event.name }}
                                            </a>
                                        </h3>

                                        <p class="event-description">
                                            {{ event.description|slice(0, 120) }}...
                                        </p>

                                        <div class="event-meta">
                                            <div class="event-meta-item">
                                                <i class="fas fa-calendar"></i>
                                                {{ event.startDate|date('d/m/Y') }}
                                            </div>
                                            <div class="event-meta-item">
                                                <i class="fas fa-clock"></i>
                                                {{ event.startDate|date('H:i') }}
                                            </div>
                                            <div class="event-meta-item">
                                                <i class="fas fa-map-marker-alt"></i>
                                                {{ event.location }}
                                            </div>
                                            <div class="event-meta-item">
                                                <i class="fas fa-users"></i>
                                                {{ event.availableSeats }} places
                                            </div>
                                        </div>

                                        <div class="event-footer">
                                            <div class="event-price">
                                                {% if event.price > 0 %}
                                                    <strong>{{ event.price }}€</strong>
                                                {% else %}
                                                    <strong class="text-success">Gratuit</strong>
                                                {% endif %}
                                            </div>
                                            <a href="{{ path('default_event_show', {id: event.id}) }}" class="btn btn-primary">
                                                {% if event.availableSeats > 0 %}
                                                    S'inscrire
                                                {% else %}
                                                    Voir détails
                                                {% endif %}
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <div class="no-results animate-fade-in">
                            <i class="fas fa-search"></i>
                            <h3>Aucun événement trouvé</h3>
                            <p>Essayez de modifier vos critères de recherche</p>
                            <a href="{{ path('default_event_index') }}" class="btn btn-primary">
                                Voir tous les événements
                            </a>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </section>

    <script>
        function applySortFilter(sortValue) {
            const url = new URL(window.location.href);
            url.searchParams.set('sort', sortValue);
            window.location.href = url.toString();
        }

        function toggleMobileFilters() {
            document.querySelector('.filters-sidebar').classList.toggle('active');
        }
    </script>
{% endblock %}
